name: Unity WebGL Build (Local)

on:
  workflow_dispatch: # Manual trigger

jobs:
  build-webgl:
    runs-on: self-hosted
    steps:
      # 1. Checkout repository without cleaning Library
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          clean: false

      # 2. Run Unity to create a Local WebGL build
      - name: Build WebGL (Local)
        run: |
          & "C:\Program Files\Unity\Hub\Editor\6000.0.37f1\Editor\Unity.exe" `
            -quit `
            -batchmode `
            -nographics `
            -projectPath "$env:GITHUB_WORKSPACE\Prudent-Unity" `
            -executeMethod BuildScript.BuildWebGLLocal `
            -logFile "$env:GITHUB_WORKSPACE\Prudent-Unity\build.log"
        shell: powershell

      # 3. Upload the generated WebGL build as an artifact
      - name: Upload WebGL Build
        uses: actions/upload-artifact@v4
        with:
          name: WebGL_Local_Build
          path: Prudent-Unity/Builds/Local/webgl_1.1
